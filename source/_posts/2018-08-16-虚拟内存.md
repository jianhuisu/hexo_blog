---
layout:     post
title:      虚拟内存
subtitle:   数据是如何存储的
date:       2018-08-15
author:     machine_su
header-img: img/post-bg-kuaidi.jpg
catalog: true
tags:
    - 计算机系统
---

虚拟内存

物理寻址

物理地址:PA
虚拟地址:VA

物理地址空间:PAS
虚拟地址空间:VAS

虚拟页号:VPN
物理页号:PPN
虚拟页面偏移:VPO virtual page offset

页命中:找到页
未命中:未找到
缺页:未找到页
牺牲页:可回收页
物理页:
虚拟页:
页:实质为一个连续的数据块

MMU : 内存管理单元
片: chunk


            PA                        PA
    cpu  ------------>  数据总线 ------------> 主存
虚拟寻址
             VA                     PA                      PA
    cpu  ---------------> MMU  ------------> 数据总线 ------------> 主存
             利用存放在主存中的查询表(Page table)来翻译
             PT 存储 虚拟地址 与 物理地址的映射关系
             操作系统负责维护 PT 内容及在 磁盘 与 DRAM 之间交换页 (swapping)
             操作系统采用按需页面调度

             如果 VP_n 未命中 那么触发缺页异常及相关内核处理程序 选择牺牲页 ,调度
             磁盘中 VP_n 至 主存中的 PP_v 并修改PTE(page table entry)


虚拟地址空间

物理地址空间

地址空间的概念可以帮助我们理解 变量名、变量值 、地址 之间的关系
主存中的每字节都有一个选自虚拟地址空间的 虚拟地址 一个选自物理地址空间的 物理地址


虚拟内存为 存储在磁盘上的数组(N个连续的字节块)
数组索引为 唯一的虚拟地址

为了有助于 清晰的理解存储层次结构中不同的缓存概念 我们定义一些专业术语

缓存的作用:
    缓存是用来平衡读写速度的

SRAM 缓存 : L1 、L2 、L3 高速缓存
DRAM 缓存 : 虚拟内存系统缓存、在主存中缓存虚拟页

将虚拟内存空间按照固定字节大小拆分为页  VP
将物理内存空间按照固定字节大小拆分为页  PP

则任意时刻
虚拟页都可以分为以下三个不相交的子集

    1 未分配的VP
    2 已分配、被缓存的VP
    3 已分配、未被缓存的VP

V_sram = 10 * V_dram = 10 * 100 000 * V_disk

高速可以做低速 的 高速缓存


操作系统为每一个进程提供一个单独的页表 : 这就是我们 常说的 独立地址空间|用户空间 的前身
多个 VP 可以映射到同一 PP ,这种行为称为 共享 PP  : 这就是我们常说的 共享代码与数据的前身
SRAM 采用物理寻址方式


虚拟内存的用途
    作为内存管理的工具
    作为内存保护的工具



吞吐率: 单位之间完成请求的数量

linux 为每一个进程维护一个单独的地址空间
